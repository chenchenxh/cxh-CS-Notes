[JAVA虚拟机、Dalvik虚拟机和ART虚拟机简要对比](https://blog.csdn.net/jason0539/article/details/50440669)

## JVM和DVM

- JVM是将字节码翻译成机器指令的 **一个软件**，主流的JVM有HotSpot等
- 在Android中的特殊需求，使用DVM。DVM虚拟机运行的是Dalvik字节码。Java语言编译后生成class文件，再把这些文件转换打包成 **一个DEX（Dalvik Executable）可执行文件**，然后DVM就可以执行这些DEX文件



## 为什么要使用DVM

- 因为android中对文件的大小要求更高，而Dalvik的可执行文件更小。原理如下：

> class文件中包含多个不同的方法签名，如果A类文件引用B类文件中的方法，方法签名也会被复制到A类文件中（在虚拟机加载类的连接阶段将会使用该签名链接到B类的对应方法），也就是说，多**个不同的类会同时包含相同的方法签名，同样地，大量的字符串常量在多个类文件中也被重复使用，这些冗余信息会直接增加文件的体积**，而JVM在把描述类的数据从class文件加载到内存时，需要对数据进行校验、转换解析和初始化，最终才形成可以被虚拟机直接使用的JAVA类型，因为大量的冗余信息，会严重影响虚拟机解析文件的效率。



> 为了减小执行文件的体积，安卓使用Dalvik虚拟机，SDK中有个dx工具负责将JAVA字节码转换为Dalvik字节码，**dx工具对JAVA类文件重新排列，将所有JAVA类文件中的常量池分解，消除其中的冗余信息，重新组合形成一个常量池**，所有的类文件共享同一个常量池，使得相同的字符串、常量在DEX文件中只出现一次，从而减小了文件的体积。

![img](https://img-blog.csdn.net/20151231114039244?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

- DVM基于寄存器结构，速度更快

JVM虚拟机是栈结构，而使用的DVM是基于寄存器结构的（虚拟，并非真正的寄存器，但是速度还是有所提高）



## ART虚拟机

首先要了解JIT（Just In Time，即时编译技术）和AOT(Ahead Of Time，预编译技术)两种编译模式。

> JIT是指运行时再将程序解释为机器指令。
>
> 相对的AOT就是指C/C++这类语言，编译器在编译时直接将程序源码编译成目标机器码，运行时直接运行机器码。

**因此直接使用ART虚拟机运行的速度会更快**

ART优点：

①系统性能显著提升

②应用启动更快、运行更快、体验更流畅、触感反馈更及时

③续航能力提升

④支持更低的硬件

ART缺点

①更大的存储空间占用，可能增加10%-20%

②更长的应用安装时间