[Java堆和栈看这篇就够了](https://iamjohnnyzhuang.github.io/java/2016/07/12/Java堆和栈看这篇就够.html)

栈区（stack）— 由编译器自动分配释放 ，存放函数的参数值，局部变量的值等。其操作方式类似于数据结构中的栈。
堆区（heap） — 一般由程序员分配释放， 若程序员不释放，程序结束时可能由OS回收 



![img](https://pic4.zhimg.com/80/v2-8aac4c4d72332b1262e8399aac1c63d3_720w.jpg)

## JVM

- 每个Java线程其实只有一个调用栈，融合了JVM规范的JVM栈与native方法栈这俩概念。

- JVM里的“堆”（heap）特指用于存放Java对象的内存区域。

  **JVM的堆被同一个JVM实例中的所有Java线程共享**。它通常由某种自动内存管理机制所管理，这种机制通常叫做“垃圾回收”（garbage collection，GC）。JVM规范并不强制要求JVM实现采用哪种GC算法。

## 区别

- 功能不同

  - 栈内存用来存储局部变量和方法调用。

- 而堆内存用来存储Java中的对象。无论是成员变量，局部变量，还是类变量，它们指向的对象都存储在堆内存中。

- 共享性不同

  - 栈内存是线程私有的。
  - 堆内存是所有线程共有的。

- 异常错误不同

  如果栈内存或者堆内存不足都会抛出异常。

  - 栈空间不足：java.lang.StackOverFlowError。
  - 堆空间不足：java.lang.OutOfMemoryError。

- 空间大小

  栈的空间大小远远小于堆的。



## 栈

[Java —— 运行时栈帧结构](https://blog.csdn.net/qian520ao/article/details/79118474)

1. **局部变量区**

2. **操作数栈**

   操作数临时区

3. **动态连接**

   包含一个指向运行时常量池中该栈帧所属方法的引用，持有这个引用是为了支付方法调用过程中的动态连接（Dynamic Linking）。

4. **方法返回地址等信息**

   分为正常返回地址和异常返回地址（由异常处理表处理）。

## 误区
1. **Java中的基本数据类型一定存储在栈中吗？**

不一定。栈内存用来存储局部变量和方法调用。

如果该局部变量是基本数据类型例如

```
int a = 1;
```

那么直接将该值存储在栈中。

如果该局部变量是一个对象如（数组是一个Object对象）

```
int[] array=new int[]{1,2};
```

那么将引用存在栈中而对象({1,2})存储在堆内。

2. 速度

一定情况下栈的速度是比堆快的，但是快的并不明显。毕竟都是RAM。所以这算不上堆和栈的一大区别。