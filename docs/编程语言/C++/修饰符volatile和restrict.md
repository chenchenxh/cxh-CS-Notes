# C++中volatile用法

volatile关键字：声明这个变量是“易变”的

volatile是c/c＋＋中一个鲜为人知的关键字,该关键字告诉编译器不要持有变量的临时拷贝。

因为变量在使用过程中很可能会被改变（通常在并行的情况下），所以为了防止出现意料之外的结果，使用这个关键字来声明。

### volatile是用来提醒编译器（优化器）必须每次都小心地重新读取这个变量的值，而不是使用保存在寄存器里的那份

使用volatile的几个场景：

1) 并行设备的硬件寄存器（如：状态寄存器）
2) 一个中断服务子程序中会访问到的非自动变量(Non-automatic variables)
3) 多线程应用中被几个任务共享的变量

### 需要注意的几点：

1. 一个参数可以既是const也是volatile
2. 一个指针也可以说volatile
3. 比如下面代码的改写需要注意，*ptr可能会中途被改变

```c++
int square(volatile int *ptr)
{
return *ptr * *ptr;
}
//应该改写为下面
int square(volatile int *ptr)
{
int a;
a = *ptr;
return a * a;
}
```

### 总结

volatile的使用主要是用在并行上，更多的是汇编级别的优化。



# c99中restrict

restrict是c99标准引入的，它只可以用于限定和约束指针，并表明指针是访问一个数据对象的唯一且初始的方式.即它告诉编译器，**所有修改该指针所指向内存中内容的操作都必须通过该指针来修改,而不能通过其它途径(其它变量或指针)来修改**

这样做的好处是,能帮助编译器进行更好的优化代码,生成更有效率的汇编代码.如 int *restrict ptr, ptr 指向的内存单元只能被 ptr 访问到，任何同样指向这个内存单元的其他指针都是未定义的，直白点就是无效指针(野指针)。这个关键字只能在C99标准的C程序里使用，C++程序不支持